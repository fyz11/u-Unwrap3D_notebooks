
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Step 3: Quasi-equiareal spherical parameterization of a genus-0 surface, \(S_{\text{ref}}(x,y,z)\) &#8212; u-Unwrap3D Analysis Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '03_basic_workflow/Step3_equiareal_spherical_parameterization';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Step 4: UV mapping \(S_{ref}(x,y,z)\) into 2D using its spherical parameterization, \(S_{\text{ref}}^{\Omega}(x,y,z)\)" href="Step4_uv_mapping_spherical_parameterization.html" />
    <link rel="prev" title="Step 2: Quasi-conformal spherical parameterization of the genus-0 reference surface, \(S_{ref}(x,y,z)\)" href="Step2_quasiconformal_spherical_parameterization.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">u-Unwrap3D Analysis Notebooks</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    u-Unwrap3D Analysis Notebooks
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Basics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/readme.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../02_installation/readme.html">Installation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Standard Workflow</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Standard workflow for unwrapping 3D surfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="Step0_find_cell_surface_from_segmentation.html">Step 0: Segmenting a single cell from a volume image</a></li>
<li class="toctree-l1"><a class="reference internal" href="Step1_find_reference_surface.html">Step 1: Find and create a genus-0 reference surface, <span class="math notranslate nohighlight">\(S_{ref}(x,y,z)\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Step2_quasiconformal_spherical_parameterization.html">Step 2: Quasi-conformal spherical parameterization of the genus-0 reference surface, <span class="math notranslate nohighlight">\(S_{ref}(x,y,z)\)</span></a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Step 3: Quasi-equiareal spherical parameterization of a genus-0 surface, <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Step4_uv_mapping_spherical_parameterization.html">Step 4: UV mapping <span class="math notranslate nohighlight">\(S_{ref}(x,y,z)\)</span> into 2D using its spherical parameterization, <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\Omega}(x,y,z)\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Step5_building_topography_surface.html">Step 5: Building the topographic <span class="math notranslate nohighlight">\((d,u,v)\)</span> space of <span class="math notranslate nohighlight">\(S_{ref}(x,y,z)\)</span></a></li>
<li class="toctree-l1"><a class="reference internal" href="Step6_find_topographic_surface_mesh.html">Step 6: Compute topographic surface <span class="math notranslate nohighlight">\(S(d,u,v)\)</span> from topographic binary segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Step7_topographic_cMCF_to_flatten.html">Step 7: Flattening the topographic surface <span class="math notranslate nohighlight">\(S(d,u,v)\)</span> onto the 2D plane</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="full_example_cells/readme.html">Full examples of standard workflow</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="full_example_cells/unwrap_bleb_cell.html">Example 1: Cell with blebs</a></li>
<li class="toctree-l2"><a class="reference internal" href="full_example_cells/unwrap_lamellipodia_cell.html">Example 2: Cell with lamellipodia</a></li>
<li class="toctree-l2"><a class="reference internal" href="full_example_cells/unwrap_filopodia_cell.html">Example 3: Cell with filopodia</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Customizing the standard workflow to input data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../04_customizing_basic_workflow/readme.html">Customizing the standard workflow for downstream analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">In-depth Breakdown of Mapping Steps</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../05_obtaining_surfaces/readme.html">Extracting surfaces from microscopy imaging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../06_find_reference_surface/readme.html">Finding the best reference shape for the analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../07_uv_parameterization/readme.html">UV unwrapping of spherical parameterizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../08_building_topography_space/readme.html">Building topography space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../09_spherical_parameterization/readme.html">Spherical parameterizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../11_flatten_topography_surface/readme.html">Flattening topography surfaces</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Transporting measurements between representations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../22_transporting_measurements/readme.html">Transferring measurements across meshes</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Applying u-Unwrap3D to live-cell imaging</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../16_shape_registration/readme.html">Shape registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../15_compute_distortion_corrected_uv_measurements/readme.html">Computing distortion-corrected measurements for analysis in uv and topopraphy space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../20_surface_flow_analytics/readme.html">Motion and information flow of measurements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../19_tracking_in_uv/readme.html">Tracking protrusions in 2D uv space</a></li>
<li class="toctree-l1"><a class="reference internal" href="../21_tracking_analytics/readme.html">Analyzing temporally tracked protrusions</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Applications of different surface representations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../13_segmenting_surface_protrusions/readme.html">Segmenting surface protrusions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../13_segmenting_surface_protrusions/binary_segment_protrusions.html">Binary protrusion segmentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13_segmenting_surface_protrusions/instance_segment_protrusions.html">Instance protrusion segmentation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../14_volumizing_reference_and_protrusions/readme.html">Decomposing surface into reference and protrusion meshes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../18_spherical_harmonics/readme.html">Harmonics analysis of surfaces</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Mapping open 3D surfaces into 2D</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../12_unwrapping_individual_protrusions/readme.html">Unwrapping individual protrusions</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../12_unwrapping_individual_protrusions/unwrap_lamellipodia_protrusion.html">Example: Unwrapping a lamellipodia</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/fyz11/u-Unwrap3D_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/fyz11/u-Unwrap3D_notebooks/issues/new?title=Issue%20on%20page%20%2F03_basic_workflow/Step3_equiareal_spherical_parameterization.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/03_basic_workflow/Step3_equiareal_spherical_parameterization.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Step 3: Quasi-equiareal spherical parameterization of a genus-0 surface, S_{\text{ref}}(x,y,z)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-s-text-ref-x-y-z-and-s-text-ref-mathcal-q-x-y-z-mesh">1. Load <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span>  and <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\mathcal{Q}}(x,y,z)\)</span> mesh</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equiareal-spherical-parameterization-s-text-ref-omega-x-y-z-by-diffusing-area-distortion">2. Equiareal spherical parameterization, <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\Omega}(x,y,z)\)</span> by diffusing area distortion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantifying-and-visualizing-the-conformal-and-equiareal-distortion-error-during-relaxation">3. Quantifying and visualizing the conformal and equiareal distortion error during relaxation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-mean-conformal-and-equiareal-error-curve-during-relaxation">4. Plotting the mean conformal and equiareal error curve during relaxation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tradeoff-between-conformal-and-equiareal">5. The tradeoff between conformal and equiareal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting-tips-for-area-distortion-relaxation">Troubleshooting tips for area distortion relaxation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-function-doesn-t-complete-1-iteration-of-relaxation-and-terminates-early">1. The function doesn’t complete 1 iteration of relaxation and terminates early.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relaxation-runs-for-xxx-iterations-doesn-t-finish-and-area-distortion-at-min-area-distort-is-much-greater-than-1">2. Relaxation runs for XXX iterations, doesn’t finish and area distortion at <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code> is much greater than 1.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cannot-find-automatically-min-area-distort">3. Cannot find automatically <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code></a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="step-3-quasi-equiareal-spherical-parameterization-of-a-genus-0-surface-s-text-ref-x-y-z">
<h1>Step 3: Quasi-equiareal spherical parameterization of a genus-0 surface, <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span><a class="headerlink" href="#step-3-quasi-equiareal-spherical-parameterization-of-a-genus-0-surface-s-text-ref-x-y-z" title="Link to this heading">#</a></h1>
<p>Any genus-0 surface can be mapped to the unit sphere by minimizing conformal error. This necessarily means shrinking surface protrusions to point-like singularities. This detrimentally affects the representation of high curvature surface protrusions when mapped to the sphere. For  cells whose reference shape is of branched morphology, this necessarily means complete under-representation of the branches and almost surely any surface protrusions displayed on the branches.</p>
<p>Consequently, it is <strong>imperative</strong> to recover area-distortion, if the objective is to analyze surface protrusions. This is the objective of Step 3.</p>
<p>The u-Unwrap3D area-distortion relaxation scheme adapts and improves the approach of <a class="reference external" href="https://www.cs.jhu.edu/~misha/MyPapers/SGP19.pdf">Lee et al.</a>, to relax distortion directly on the sphere iteratively to achieve near-ideal area-distortion minimization. Theoretically any genus-0 surface should be relaxable. Practically, we are beholden to the limitations of computer precision, such that optimal area-distortion is achievable if users construct or modify <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> to satisfy the following: <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> should not have i) sharp features, ii) be isotropically meshed, iii) not have thin necks, and iv) not be too densely meshed. All 4 of these criteria is to allow for the area distortion to be ‘diffused’. i), iii) are ensured by dilating the shape and remeshing, as described in Step 1. ii), iv) is achieved by isotropic remeshing to achieve a desired average edge length.</p>
<p><strong>Note on the tradeoff of conformal and equiareal distortion:</strong>  For a closed 3D surface, it is not possible to jointly minimize conformal and equiareal distortion like a seesaw - improving one necessarily increases the other error. Conformal maps preserve local angles - this has many nice mathematical properties such as being able to apply calculus. Meanwhile, equiareal maps are required to properly represent surface protrusions but comes at the cost of potentially greatly distorting local orientation. Consequently u-Unwrap3D has designed an iterative relaxation procedure so that users can adjust the degree of relaxation based on their desired objective e.g. minimize up to a certain target error, achieve an isometric map that balances conformal and area distortion etc.</p>
<section id="load-s-text-ref-x-y-z-and-s-text-ref-mathcal-q-x-y-z-mesh">
<h2>1. Load <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span>  and <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\mathcal{Q}}(x,y,z)\)</span> mesh<a class="headerlink" href="#load-s-text-ref-x-y-z-and-s-text-ref-mathcal-q-x-y-z-mesh" title="Link to this heading">#</a></h2>
<p>We assume the user has worked through step 2 which generates and saves the conformal spherical parameterization, <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\mathcal{Q}}(x,y,z)\)</span> of the genus-0 reference surface, <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> of an input cell surface mesh to the folder <code class="docutils literal notranslate"><span class="pre">example_results/bleb_example/step2_conformal_sphere_param</span></code>. We also need the reference surface mesh, <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> which was computed in step 1 and was saved to the folder <code class="docutils literal notranslate"><span class="pre">example_results/bleb_example/step1_cMCF_reference</span></code>. Moreover these surface has been colored by mean curvature of <span class="math notranslate nohighlight">\(S(x,y,z)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unwrap3D.Utility_Functions.file_io</span> <span class="k">as</span> <span class="nn">fio</span>
<span class="kn">import</span> <span class="nn">unwrap3D.Mesh.meshtools</span> <span class="k">as</span> <span class="nn">meshtools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">spio</span>

<span class="c1"># example cell used</span>
<span class="n">imgfolder</span> <span class="o">=</span> <span class="s1">&#39;../../data/img&#39;</span>
<span class="n">imgfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">imgfolder</span><span class="p">,</span> <span class="s1">&#39;bleb_example.tif&#39;</span><span class="p">)</span>
<span class="n">basefname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">imgfile</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># get the filename with extension</span>

<span class="c1"># create the analysis save folder for this step</span>
<span class="n">savefolder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;example_results&#39;</span><span class="p">,</span> 
                         <span class="n">basefname</span><span class="p">,</span>
                         <span class="s1">&#39;step3_equiareal_sphere_param&#39;</span><span class="p">)</span>
<span class="n">fio</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">savefolder</span><span class="p">)</span> <span class="c1"># auto generates the specified folder structure if doesn&#39;t currently exist.</span>


<span class="c1"># load the pre-computed genus-0 reference, S_ref(x,y,z)</span>
<span class="n">S_ref_folder</span> <span class="o">=</span> <span class="s1">&#39;example_results/</span><span class="si">%s</span><span class="s1">/step1_cMCF_reference&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">basefname</span><span class="p">)</span>
<span class="n">S_ref_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">S_ref_folder</span><span class="p">,</span> 
                            <span class="s1">&#39;unwrap_cMCF_Sref_mesh_H_color.obj&#39;</span><span class="p">)</span> 
<span class="n">S_ref_mesh</span> <span class="o">=</span> <span class="n">meshtools</span><span class="o">.</span><span class="n">read_mesh</span><span class="p">(</span><span class="n">S_ref_file</span><span class="p">)</span>

<span class="c1"># load the pre-computed genus-0 spherical parameterization of S_ref(x,y,z)</span>
<span class="n">conformal_folder</span> <span class="o">=</span> <span class="s1">&#39;example_results/</span><span class="si">%s</span><span class="s1">/step2_conformal_sphere_param&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">basefname</span><span class="p">)</span>
<span class="n">conformal_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conformal_folder</span><span class="p">,</span> 
                               <span class="s1">&#39;iterative-conformal_sphere_param_Sref_</span><span class="si">%s</span><span class="s1">.obj&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">basefname</span><span class="p">))</span>
<span class="n">conformal_sphere_mesh</span> <span class="o">=</span> <span class="n">meshtools</span><span class="o">.</span><span class="n">read_mesh</span><span class="p">(</span><span class="n">conformal_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="equiareal-spherical-parameterization-s-text-ref-omega-x-y-z-by-diffusing-area-distortion">
<h2>2. Equiareal spherical parameterization, <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\Omega}(x,y,z)\)</span> by diffusing area distortion<a class="headerlink" href="#equiareal-spherical-parameterization-s-text-ref-omega-x-y-z-by-diffusing-area-distortion" title="Link to this heading">#</a></h2>
<p>To relax area distortion, we can compute the area fraction of the current spherical parameterization and <span class="math notranslate nohighlight">\(S_{ref}\)</span>. We can think of this as a sort of energy and advect the vertices on the sphere to maximally dissipate this energy over the surface. As this dissipation necessarily requires changing the triangle edge lengths, minimizing area distortion is in direct opposition to minimizing conformal error.</p>
<p>Depending on the intended application, the user does not need to fully relax the area. For this reason we chose to implement an iterative relaxation scheme.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Area distortion relaxation from conformal to equiareal.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># For a single cell I like to set debugviz=True to check the flow is working, if the function is terminating much earlier than expected. The flow will not work if the input mesh doesn&#39;t support flow either because triangles are insufficiently large or if they are not near-equilateral</span>
<span class="c1"># debugviz=True will plot a histogram of the log(area distortion). If it is working the histogram should steadily converge to a symmetric distribution around 0. </span>
<span class="c1"># If the plots don&#39;t converge see troubleshooting tips below.</span>
<span class="n">relax_v</span><span class="p">,</span> <span class="n">relax_f</span><span class="p">,</span> <span class="n">area_distortion_iter</span><span class="o">=</span> <span class="n">meshtools</span><span class="o">.</span><span class="n">area_distortion_flow_relax_sphere</span><span class="p">(</span><span class="n">conformal_sphere_mesh</span><span class="p">,</span> 
                                                                                    <span class="n">S_ref_mesh</span><span class="p">,</span> 
                                                                                    <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c1"># this needs to be increased the more S_ref deviates from spherical. </span>
                                                                                    <span class="n">delta</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="c1"># controls the stiffness, if too high - there is no flow, if too low - bijectivity is lost and flow may breakdown </span>
                                                                                    <span class="n">stepsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                                                                                    <span class="n">debugviz</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 

<span class="c1"># compute the evolution of the mean area distortion. We use this to determine the first iteration when area distortion is minimized. </span>
<span class="n">area_distortion_iter_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="k">for</span> <span class="n">mm</span> <span class="ow">in</span> <span class="n">area_distortion_iter</span><span class="p">])</span>

<span class="c1"># to determine when area distortion is minimised we look for the timepoint when the sign first changes. This is because once the minimum is reached, depending on stepsize, the mesh will start to oscilate. The larger the stepsize, the faster the convergence but the larger the oscillatory instability. </span>
<span class="n">min_area_distort</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">))[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># falls below 0. </span>

<span class="c1"># check: print the area distortion value at min_area_distort. This should be close to 1 (the ideal minimum) for optimal relaxation.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;distortion at found iteration number:&#39;</span><span class="p">,</span> <span class="n">area_distortion_iter_curve</span><span class="p">[</span><span class="n">min_area_distort</span><span class="p">])</span>


<span class="c1"># the area_distortion_iter_curve is another great check of things are working, we plot the np.log(curve) to visualize a log scale.</span>
<span class="c1"># the curve should go down smoothly, if the decay is bumpy etc, it means the mesh is not great, and can be improved </span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span> 

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">),</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">min_area_distort</span><span class="p">,</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">)),</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">)),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">area_distortion_iter_curve</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration Number&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Area distortion&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savefolder</span><span class="p">,</span> 
                          <span class="s1">&#39;area-distortion_relax_iterations_&#39;</span><span class="o">+</span><span class="n">basefname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;.svg&#39;</span><span class="p">)),</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># create the equiareal mesh and save it out</span>
<span class="n">equiareal_sphere_mesh</span> <span class="o">=</span> <span class="n">conformal_sphere_mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">equiareal_sphere_mesh</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">relax_v</span><span class="p">[</span><span class="n">min_area_distort</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">tmp</span> <span class="o">=</span> <span class="n">equiareal_sphere_mesh</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savefolder</span><span class="p">,</span>
                                               <span class="s1">&#39;equiareal_sphere_param_Sref_</span><span class="si">%s</span><span class="s1">.obj&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">basefname</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 100/100 [00:27&lt;00:00,  3.69it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>distortion at found iteration number: 0.9995375983497246
</pre></div>
</div>
<img alt="../_images/502ae4ed87c93acd41a6454b330524fd42902aece62bfe687187c29bfbb3cae4.png" src="../_images/502ae4ed87c93acd41a6454b330524fd42902aece62bfe687187c29bfbb3cae4.png" />
</div>
</div>
</section>
<section id="quantifying-and-visualizing-the-conformal-and-equiareal-distortion-error-during-relaxation">
<h2>3. Quantifying and visualizing the conformal and equiareal distortion error during relaxation<a class="headerlink" href="#quantifying-and-visualizing-the-conformal-and-equiareal-distortion-error-during-relaxation" title="Link to this heading">#</a></h2>
<p>Area distortion is computed as part of the relaxation process. Below, we compute the conformal error per iteration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unwrap3D.Visualisation.colors</span> <span class="k">as</span> <span class="nn">vol_colors</span>
<span class="kn">import</span> <span class="nn">unwrap3D.Visualisation.plotting</span> <span class="k">as</span> <span class="nn">plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span> 
<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span> 

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Compute the conformal error for each iteration of the relaxation and also color the resulting mesh. </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">save_area_relaxation_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savefolder</span><span class="p">,</span> <span class="s1">&#39;area_relaxation_iterations&#39;</span><span class="p">);</span> 
<span class="n">fio</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">save_area_relaxation_folder</span><span class="p">)</span>


<span class="c1"># this will save both the conformal + equiareal error.</span>
<span class="n">conformal_error_flow</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">iter_ii</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">area_distortion_iter</span><span class="p">)):</span>

    <span class="c1"># color by curvature</span>
    <span class="n">relax_mesh_H</span> <span class="o">=</span> <span class="n">conformal_sphere_mesh</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">relax_mesh_H</span><span class="o">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">relax_v</span><span class="p">[</span><span class="n">iter_ii</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">relax_mesh_H</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_area_relaxation_folder</span><span class="p">,</span>
                                           <span class="s1">&#39;sphere_curvature_</span><span class="si">%s</span><span class="s1">.obj&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_ii</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))))</span>

    <span class="c1"># color by area distortion error</span>
    <span class="n">area_distortion_error_colors</span> <span class="o">=</span> <span class="n">vol_colors</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">area_distortion_iter</span><span class="p">[</span><span class="n">iter_ii</span><span class="p">]),</span> 
                                                         <span class="n">colormap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">,</span> 
                                                         <span class="n">vmin</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">relax_mesh_area_distort</span> <span class="o">=</span> <span class="n">meshtools</span><span class="o">.</span><span class="n">create_mesh</span><span class="p">(</span><span class="n">relax_v</span><span class="p">[</span><span class="n">iter_ii</span><span class="p">],</span>
                                                    <span class="n">relax_f</span><span class="p">[</span><span class="n">iter_ii</span><span class="p">],</span>
                                                    <span class="n">face_colors</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="n">area_distortion_error_colors</span><span class="p">[</span><span class="o">...</span><span class="p">,:</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">relax_mesh_area_distort</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_area_relaxation_folder</span><span class="p">,</span>
                                                <span class="s1">&#39;sphere_area_distortion_</span><span class="si">%s</span><span class="s1">.obj&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_ii</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))))</span>

    <span class="c1"># measure and color by conformal error relative to the sphere at the start</span>
    <span class="n">conformal_errors</span> <span class="o">=</span> <span class="n">meshtools</span><span class="o">.</span><span class="n">quasi_conformal_error</span><span class="p">(</span><span class="n">relax_v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
                                                      <span class="n">relax_v</span><span class="p">[</span><span class="n">iter_ii</span><span class="p">],</span> 
                                                      <span class="n">relax_f</span><span class="p">[</span><span class="n">iter_ii</span><span class="p">])</span>
    <span class="n">conformal_error_flow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conformal_errors</span><span class="p">)</span>

    <span class="n">conformal_error_color</span> <span class="o">=</span> <span class="n">vol_colors</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">conformal_errors</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># per face conformal error. </span>
                                                  <span class="n">colormap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> 
                                                  <span class="n">vmin</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">relax_mesh_conformal_error</span> <span class="o">=</span> <span class="n">relax_mesh_area_distort</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">relax_mesh_conformal_error</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">face_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="mi">255</span><span class="o">*</span><span class="n">conformal_error_color</span><span class="p">)</span>
    <span class="n">relax_mesh_conformal_error</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_area_relaxation_folder</span><span class="p">,</span>
                                                   <span class="s1">&#39;sphere_conformal_error_</span><span class="si">%s</span><span class="s1">.obj&#39;</span> <span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_ii</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))))</span>
    
    
    <span class="c1"># matplotlib visualization of curvature, conformal error and area-distortion error.</span>
    <span class="c1"># you should see that as the area-distortion dissipates, conformal error increase</span>
    <span class="n">sampling</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># plot every just so its not fully dense in the plot so we don&#39;t see anything!</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$H(S(x,y,z)$) &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_ii</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">relax_mesh_H</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> 
               <span class="n">relax_mesh_H</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
               <span class="n">relax_mesh_H</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
               <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
               <span class="n">c</span><span class="o">=</span><span class="n">relax_mesh_H</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
    <span class="n">plotting</span><span class="o">.</span><span class="n">set_axes_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;conformal error &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_ii</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">relax_mesh_conformal_error</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> 
               <span class="n">relax_mesh_conformal_error</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
               <span class="n">relax_mesh_conformal_error</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
               <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
               <span class="n">c</span><span class="o">=</span><span class="n">relax_mesh_conformal_error</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
    <span class="n">plotting</span><span class="o">.</span><span class="n">set_axes_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;area-distortion error &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iter_ii</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">relax_mesh_area_distort</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> 
               <span class="n">relax_mesh_area_distort</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
               <span class="n">relax_mesh_area_distort</span><span class="o">.</span><span class="n">vertices</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> 
               <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
               <span class="n">c</span><span class="o">=</span><span class="n">relax_mesh_area_distort</span><span class="o">.</span><span class="n">visual</span><span class="o">.</span><span class="n">vertex_colors</span><span class="p">[::</span><span class="n">sampling</span><span class="p">,:</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
    <span class="n">plotting</span><span class="o">.</span><span class="n">set_axes_equal</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
<span class="c1"># reorganising the conformal error_flow from the relaxation process. </span>
<span class="n">conformal_error_flow_arrays</span> <span class="o">=</span> <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cc</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span> <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">conformal_error_flow</span><span class="p">])</span> <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conformal_error_flow</span><span class="p">[</span><span class="mi">0</span><span class="p">]))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7ab8f468b6664e7de165b8dc96de5ffb29ed3d810db267d4d6251adbecbc643b.png" src="../_images/7ab8f468b6664e7de165b8dc96de5ffb29ed3d810db267d4d6251adbecbc643b.png" />
<img alt="../_images/52936785c3bce856f939aa1577c3d458eaeabf6234f427f4a4d84176ae40aab0.png" src="../_images/52936785c3bce856f939aa1577c3d458eaeabf6234f427f4a4d84176ae40aab0.png" />
<img alt="../_images/4a5161236af6124a4c3311f7ab84d8057b4bfd5c3876856163f19f8a6d15d807.png" src="../_images/4a5161236af6124a4c3311f7ab84d8057b4bfd5c3876856163f19f8a6d15d807.png" />
<img alt="../_images/cc853323e84d9f3cfbc28a6fff9b70f46a9eb18b1ed6872cc473698dafb94853.png" src="../_images/cc853323e84d9f3cfbc28a6fff9b70f46a9eb18b1ed6872cc473698dafb94853.png" />
<img alt="../_images/1a6d19bd9d2bb95862142701bfe0a2ffcaa1aee8faeaed09e1e828a5b99ccdbf.png" src="../_images/1a6d19bd9d2bb95862142701bfe0a2ffcaa1aee8faeaed09e1e828a5b99ccdbf.png" />
<img alt="../_images/348b3e6167d7a27f7e02f40964a90d83306ba80494e798e3300c961168a2dc1a.png" src="../_images/348b3e6167d7a27f7e02f40964a90d83306ba80494e798e3300c961168a2dc1a.png" />
<img alt="../_images/449c319a8b00e4acb749ec74379f318e5b14986e717385e804926e58cbe7c9d4.png" src="../_images/449c319a8b00e4acb749ec74379f318e5b14986e717385e804926e58cbe7c9d4.png" />
<img alt="../_images/52db486d6bb9bee4b283c081bdd10486ad3661d0df76f33fd79c9052d1dec793.png" src="../_images/52db486d6bb9bee4b283c081bdd10486ad3661d0df76f33fd79c9052d1dec793.png" />
<img alt="../_images/0e2387b3087e75625c2deb975af928947d17af13641384f9742bee523d591162.png" src="../_images/0e2387b3087e75625c2deb975af928947d17af13641384f9742bee523d591162.png" />
<img alt="../_images/506b901db940e45ce0a06f3a731902f5e52330912ddd64c01cf11fcd6b6f1140.png" src="../_images/506b901db940e45ce0a06f3a731902f5e52330912ddd64c01cf11fcd6b6f1140.png" />
<img alt="../_images/5715f1f600b7125ee802b42c8b48891226d8ad1120dd8111e9bab30535a2c2b4.png" src="../_images/5715f1f600b7125ee802b42c8b48891226d8ad1120dd8111e9bab30535a2c2b4.png" />
<img alt="../_images/036c8593442b9d7e27995a92015e0e0a2602b6099cb91b60f169bc9edc1c11dc.png" src="../_images/036c8593442b9d7e27995a92015e0e0a2602b6099cb91b60f169bc9edc1c11dc.png" />
<img alt="../_images/f5b4e4761f38e9d016d1288696fb36793dc4da6435ff78fc99409a74d3c5cf12.png" src="../_images/f5b4e4761f38e9d016d1288696fb36793dc4da6435ff78fc99409a74d3c5cf12.png" />
<img alt="../_images/ffc2d42af1fe7722b7484e3d35444905c715baebea7d8708afdb3db021d26695.png" src="../_images/ffc2d42af1fe7722b7484e3d35444905c715baebea7d8708afdb3db021d26695.png" />
<img alt="../_images/b2f1ef0aef7f719e5e9eeebdfc7a61985e97c965b64e87d5943892d2ae98b040.png" src="../_images/b2f1ef0aef7f719e5e9eeebdfc7a61985e97c965b64e87d5943892d2ae98b040.png" />
<img alt="../_images/ecd8c7aaadb1c57892fc068c5e06f5f3a6e7d46e4efb3d7eb102d9174d482cae.png" src="../_images/ecd8c7aaadb1c57892fc068c5e06f5f3a6e7d46e4efb3d7eb102d9174d482cae.png" />
<img alt="../_images/42e9b21af5fce6aeefe1567c6184188ccde31e31329147a3a09e4ff98519a06d.png" src="../_images/42e9b21af5fce6aeefe1567c6184188ccde31e31329147a3a09e4ff98519a06d.png" />
<img alt="../_images/a270dff1af8703cc0929d515a2f2a20d425f2fe2c49b3006669d9a1994392072.png" src="../_images/a270dff1af8703cc0929d515a2f2a20d425f2fe2c49b3006669d9a1994392072.png" />
<img alt="../_images/4601ae538fdd61ce941ddda9bcab3656cb512b6f25c6e0f342a798c0c588ebf1.png" src="../_images/4601ae538fdd61ce941ddda9bcab3656cb512b6f25c6e0f342a798c0c588ebf1.png" />
<img alt="../_images/a2516161aac297270e29df43cbb596a86a9cd8d5f31936c4b426ca35c64c29c7.png" src="../_images/a2516161aac297270e29df43cbb596a86a9cd8d5f31936c4b426ca35c64c29c7.png" />
<img alt="../_images/795e80f52caa9537b08974b636fbd99e5a040af36686a390b81b80fb3fd86e0f.png" src="../_images/795e80f52caa9537b08974b636fbd99e5a040af36686a390b81b80fb3fd86e0f.png" />
<img alt="../_images/e35517218c8fc3a5ead0a29a9908fe765926abc57d687c837ce27f20b82bba41.png" src="../_images/e35517218c8fc3a5ead0a29a9908fe765926abc57d687c837ce27f20b82bba41.png" />
<img alt="../_images/32e96975bbb64268c2fe655082d5cf26c80f0ee5c55dc3ea6d8a1e7bcc5982c0.png" src="../_images/32e96975bbb64268c2fe655082d5cf26c80f0ee5c55dc3ea6d8a1e7bcc5982c0.png" />
<img alt="../_images/b2bbd0a4ca7e714927367c1a6df895529d55ca879eaa7772f41f4121f56c7c51.png" src="../_images/b2bbd0a4ca7e714927367c1a6df895529d55ca879eaa7772f41f4121f56c7c51.png" />
<img alt="../_images/348c661d779e338da6187a6ba46f95c631e6ba162df4495168ba505be16af0cb.png" src="../_images/348c661d779e338da6187a6ba46f95c631e6ba162df4495168ba505be16af0cb.png" />
<img alt="../_images/5f0f7c124d4863cfdbd1c539cba22f620666e30232aca14c2aaeb4fc59d0e0dc.png" src="../_images/5f0f7c124d4863cfdbd1c539cba22f620666e30232aca14c2aaeb4fc59d0e0dc.png" />
<img alt="../_images/35d5c6274068d772630ee3eaa19e00b98281459cb76e2c8ba9b2cf61cbaded3c.png" src="../_images/35d5c6274068d772630ee3eaa19e00b98281459cb76e2c8ba9b2cf61cbaded3c.png" />
<img alt="../_images/a61e4890a4b6065691541da83009fb1080e10f25e99e1e2b22cc6768bc7275b5.png" src="../_images/a61e4890a4b6065691541da83009fb1080e10f25e99e1e2b22cc6768bc7275b5.png" />
<img alt="../_images/3d562c8b1c397d1413c3c1cd3f58a2957e6213a9f4412f66e8d68a875a04d77b.png" src="../_images/3d562c8b1c397d1413c3c1cd3f58a2957e6213a9f4412f66e8d68a875a04d77b.png" />
<img alt="../_images/b55f6d8b773fc5cc140cd037e46f3c550a47376abf6006d5f1087abdc5bb22f1.png" src="../_images/b55f6d8b773fc5cc140cd037e46f3c550a47376abf6006d5f1087abdc5bb22f1.png" />
<img alt="../_images/89505c0532acd9c45363121493e5e41ec1bccd20e6ade8730b2ec63d618fe62f.png" src="../_images/89505c0532acd9c45363121493e5e41ec1bccd20e6ade8730b2ec63d618fe62f.png" />
<img alt="../_images/29ff1402476aca388c038db390521a851d601d739b67cfbcef091aa83735dcce.png" src="../_images/29ff1402476aca388c038db390521a851d601d739b67cfbcef091aa83735dcce.png" />
<img alt="../_images/3f0a82d51c3e4f3298c0c936c6cd8a4e8366f467e40efdadd5eb7463f27e6aec.png" src="../_images/3f0a82d51c3e4f3298c0c936c6cd8a4e8366f467e40efdadd5eb7463f27e6aec.png" />
<img alt="../_images/e53fdc704c123ca415d0ccef45b3968f2a6c0847d775a0f76f660999ab217800.png" src="../_images/e53fdc704c123ca415d0ccef45b3968f2a6c0847d775a0f76f660999ab217800.png" />
<img alt="../_images/4df0bee01759672cc8e4b9dc3c49fab17cd314b2a414f071838daa4197c00aa6.png" src="../_images/4df0bee01759672cc8e4b9dc3c49fab17cd314b2a414f071838daa4197c00aa6.png" />
<img alt="../_images/4bfcc13cd0b0df98b2c5d21a9fb23f988087d6cbae74fe6f27031dea75c5ae05.png" src="../_images/4bfcc13cd0b0df98b2c5d21a9fb23f988087d6cbae74fe6f27031dea75c5ae05.png" />
<img alt="../_images/9a9037ffa3e988cb8f68ed3a66788047b1d5563c5251941f908233f91cf18349.png" src="../_images/9a9037ffa3e988cb8f68ed3a66788047b1d5563c5251941f908233f91cf18349.png" />
<img alt="../_images/45f5103b7a3e51c4f6f3374cb8d59e459befdd04e84b2ea17a302f187318fc00.png" src="../_images/45f5103b7a3e51c4f6f3374cb8d59e459befdd04e84b2ea17a302f187318fc00.png" />
<img alt="../_images/14b880f3254765a0c78c9d659548942eeeb427f0c60329769e26fdc3ae46b212.png" src="../_images/14b880f3254765a0c78c9d659548942eeeb427f0c60329769e26fdc3ae46b212.png" />
<img alt="../_images/13c5f6638a1dfbc02b4337dd6eb82268fee875770e8223c97dafdb30f4881b64.png" src="../_images/13c5f6638a1dfbc02b4337dd6eb82268fee875770e8223c97dafdb30f4881b64.png" />
<img alt="../_images/68b97ea360b3c2f2b66eb8ef85abbf7d71d04caedfc44016f17538b1df75c404.png" src="../_images/68b97ea360b3c2f2b66eb8ef85abbf7d71d04caedfc44016f17538b1df75c404.png" />
<img alt="../_images/3dac7751f74cb5b2b5ffccdcd9cf50e3da4e31851c64bba884efd39a183abb89.png" src="../_images/3dac7751f74cb5b2b5ffccdcd9cf50e3da4e31851c64bba884efd39a183abb89.png" />
<img alt="../_images/162a7aa0d28fb16ef3e488b51ea463eae7e2013290a29aa5d4998500d8c5f52a.png" src="../_images/162a7aa0d28fb16ef3e488b51ea463eae7e2013290a29aa5d4998500d8c5f52a.png" />
<img alt="../_images/39b8b63435743e6d3c2372b74386aa6f1fae1caa803b2ae14313a29535652b3f.png" src="../_images/39b8b63435743e6d3c2372b74386aa6f1fae1caa803b2ae14313a29535652b3f.png" />
<img alt="../_images/79644f990bc8135bcf6d265e060b4f393d691944dd759378711703eab168485d.png" src="../_images/79644f990bc8135bcf6d265e060b4f393d691944dd759378711703eab168485d.png" />
<img alt="../_images/2881645aebce0218c3de81a07d499f363b7709e4507f5f87d73dc9653de0d1bd.png" src="../_images/2881645aebce0218c3de81a07d499f363b7709e4507f5f87d73dc9653de0d1bd.png" />
<img alt="../_images/948725fc5dd4a9370b4372b1dcfabee5ad56fb43f6b3aef924bc2fe6deeac459.png" src="../_images/948725fc5dd4a9370b4372b1dcfabee5ad56fb43f6b3aef924bc2fe6deeac459.png" />
<img alt="../_images/0a2ced1141f825b2b07811e038e87ee4b3a2a164980636eefdfd51fd05d4eb51.png" src="../_images/0a2ced1141f825b2b07811e038e87ee4b3a2a164980636eefdfd51fd05d4eb51.png" />
<img alt="../_images/94e8021235d55e5e440c86952bae54a3fbb5c0c141f9f6c1dec8857bad0bd265.png" src="../_images/94e8021235d55e5e440c86952bae54a3fbb5c0c141f9f6c1dec8857bad0bd265.png" />
<img alt="../_images/795121178c3665c250ae3fe96c51b2c34b218e4e641cb9dec188286e5b79311d.png" src="../_images/795121178c3665c250ae3fe96c51b2c34b218e4e641cb9dec188286e5b79311d.png" />
<img alt="../_images/b26c4818fd9d2baebc5cd91670a8854ef80b7961332d9f355a7c0207af7cb6f3.png" src="../_images/b26c4818fd9d2baebc5cd91670a8854ef80b7961332d9f355a7c0207af7cb6f3.png" />
<img alt="../_images/4c41de3de4765a3570a61059566874e1b78631177cb9128d49bfd8ea6ce91bde.png" src="../_images/4c41de3de4765a3570a61059566874e1b78631177cb9128d49bfd8ea6ce91bde.png" />
<img alt="../_images/d7dfbfac6ad8cd9bd4dd453b66cfcfdaf57706fa1ba4e6b514411b86386ee746.png" src="../_images/d7dfbfac6ad8cd9bd4dd453b66cfcfdaf57706fa1ba4e6b514411b86386ee746.png" />
<img alt="../_images/f78e0e96c1c37a03a3fe7c4803ebec1e20c388e14860d680ff7572a6a0f83567.png" src="../_images/f78e0e96c1c37a03a3fe7c4803ebec1e20c388e14860d680ff7572a6a0f83567.png" />
<img alt="../_images/b02bdd190def209ff9e6e03483db4ed8b47b797cfc4777bcc66b0e45b47e1638.png" src="../_images/b02bdd190def209ff9e6e03483db4ed8b47b797cfc4777bcc66b0e45b47e1638.png" />
<img alt="../_images/8e22ea8b1cc73664617ee50fbe7522b3ed4c94be8b851bcf7e811dcfd1343c8c.png" src="../_images/8e22ea8b1cc73664617ee50fbe7522b3ed4c94be8b851bcf7e811dcfd1343c8c.png" />
<img alt="../_images/6236338ff2a5897788ff5620308167c7f49a4476ed68194d630276db4e41562e.png" src="../_images/6236338ff2a5897788ff5620308167c7f49a4476ed68194d630276db4e41562e.png" />
<img alt="../_images/8f44a12f7bbf36c435ef9a1d227d4f5aad1cd4b22654eac7b60ecc197876f946.png" src="../_images/8f44a12f7bbf36c435ef9a1d227d4f5aad1cd4b22654eac7b60ecc197876f946.png" />
<img alt="../_images/50784cdfe474ade8680051df2e36502cf55f5cf882154a79f346c0d3e698a7be.png" src="../_images/50784cdfe474ade8680051df2e36502cf55f5cf882154a79f346c0d3e698a7be.png" />
<img alt="../_images/a61717d0d2576d7dc1e7e568049f0beccf7473b6dd8968b640a00176da760210.png" src="../_images/a61717d0d2576d7dc1e7e568049f0beccf7473b6dd8968b640a00176da760210.png" />
<img alt="../_images/a0613d06b242c2ff2b601954ec5ec21f4e07d1030b436899fbea87a2a8157e23.png" src="../_images/a0613d06b242c2ff2b601954ec5ec21f4e07d1030b436899fbea87a2a8157e23.png" />
<img alt="../_images/611f9c3859fc512071b7d4d9f43d2dc36425493f2e59b1b7a8ee5e02c67074b5.png" src="../_images/611f9c3859fc512071b7d4d9f43d2dc36425493f2e59b1b7a8ee5e02c67074b5.png" />
<img alt="../_images/e9c758833726be7653adcfd5ec617b5f4ac43e39e7b9953bf1c51a6e7be0057f.png" src="../_images/e9c758833726be7653adcfd5ec617b5f4ac43e39e7b9953bf1c51a6e7be0057f.png" />
<img alt="../_images/7e33a5c089b17330476f871df42b1b2c6869cf05067daeb9c41b07d25b7d5bdf.png" src="../_images/7e33a5c089b17330476f871df42b1b2c6869cf05067daeb9c41b07d25b7d5bdf.png" />
<img alt="../_images/174ec5df4b8238c07bc00fd55a8e87ec9f0ea3856988b17af7cf3e671db2331b.png" src="../_images/174ec5df4b8238c07bc00fd55a8e87ec9f0ea3856988b17af7cf3e671db2331b.png" />
<img alt="../_images/bed273e18e4fd4e9be2b5280960fa3d11c1bbd7b09af194d36cf9bb00164ab57.png" src="../_images/bed273e18e4fd4e9be2b5280960fa3d11c1bbd7b09af194d36cf9bb00164ab57.png" />
<img alt="../_images/85f9ca9d96dc8858d8f2ba24a0de81193f862bc2497bf8ab6d718c25790e8878.png" src="../_images/85f9ca9d96dc8858d8f2ba24a0de81193f862bc2497bf8ab6d718c25790e8878.png" />
<img alt="../_images/e6666c1c21c434bf60c421a88cc95f836c6f9b04da6afca11ef221e30ccccdf4.png" src="../_images/e6666c1c21c434bf60c421a88cc95f836c6f9b04da6afca11ef221e30ccccdf4.png" />
<img alt="../_images/115cea0b9795945c76c36c458a032b67ac51f61782efaed06fd8ec297bb13613.png" src="../_images/115cea0b9795945c76c36c458a032b67ac51f61782efaed06fd8ec297bb13613.png" />
<img alt="../_images/677ef6d526550ade0157c1e6b5844cecdd8851b4e0876d710e831d2c153b01d6.png" src="../_images/677ef6d526550ade0157c1e6b5844cecdd8851b4e0876d710e831d2c153b01d6.png" />
<img alt="../_images/c407f6ac604a93dbae43e4b186ced101c8b6636113430c58799d1e917e951b5f.png" src="../_images/c407f6ac604a93dbae43e4b186ced101c8b6636113430c58799d1e917e951b5f.png" />
<img alt="../_images/389010dc42a3186d6bdb1fd16e3a44f50f683ce062d52e807141a9884ba27844.png" src="../_images/389010dc42a3186d6bdb1fd16e3a44f50f683ce062d52e807141a9884ba27844.png" />
<img alt="../_images/eb9a4c43f7732b65697cfe12ee2725aa1804680df744d673c0a86cc680c048a2.png" src="../_images/eb9a4c43f7732b65697cfe12ee2725aa1804680df744d673c0a86cc680c048a2.png" />
<img alt="../_images/b8bc0b017364ea3c10568d9a889f1ca31359578dbe8ec104ed0a03c3e0cfb0cd.png" src="../_images/b8bc0b017364ea3c10568d9a889f1ca31359578dbe8ec104ed0a03c3e0cfb0cd.png" />
<img alt="../_images/57ca70e2807fa3b2033a3ac64292170b6be17bed4d226102713025909b406db6.png" src="../_images/57ca70e2807fa3b2033a3ac64292170b6be17bed4d226102713025909b406db6.png" />
<img alt="../_images/fc52639402cb1dc44e197f13bc5e2fa742b77a2663a7a48fbb8907f1bf7d3569.png" src="../_images/fc52639402cb1dc44e197f13bc5e2fa742b77a2663a7a48fbb8907f1bf7d3569.png" />
<img alt="../_images/2ea0de0b37ce8c2b20f4da4959c19abb58aad147a8212169f58825ada638e5e8.png" src="../_images/2ea0de0b37ce8c2b20f4da4959c19abb58aad147a8212169f58825ada638e5e8.png" />
<img alt="../_images/616058ac679f391500ca0bd58f9af473644007465a4097472cedebc99ae9dca8.png" src="../_images/616058ac679f391500ca0bd58f9af473644007465a4097472cedebc99ae9dca8.png" />
<img alt="../_images/9f740f88905b08daad385f69ac989624fdb759d3d96d7f8136ad224aff21d3b5.png" src="../_images/9f740f88905b08daad385f69ac989624fdb759d3d96d7f8136ad224aff21d3b5.png" />
<img alt="../_images/c87f07a45d6ff2a48673601787142f53f48f7b02b684d0aafee23a6dca95c0b2.png" src="../_images/c87f07a45d6ff2a48673601787142f53f48f7b02b684d0aafee23a6dca95c0b2.png" />
<img alt="../_images/3ac183d931692aac44e70eb5a01a8b952b3ff7027dbbf327281974c60a8ae570.png" src="../_images/3ac183d931692aac44e70eb5a01a8b952b3ff7027dbbf327281974c60a8ae570.png" />
<img alt="../_images/0ed1976b4fa757ea56be5ea9439a5d5b4d778e4e0b0c4f9d152aa968b457e306.png" src="../_images/0ed1976b4fa757ea56be5ea9439a5d5b4d778e4e0b0c4f9d152aa968b457e306.png" />
<img alt="../_images/9e3ff13168952fde2a75d4121b19b85e640a21905979f27065dcfaf062d69d4d.png" src="../_images/9e3ff13168952fde2a75d4121b19b85e640a21905979f27065dcfaf062d69d4d.png" />
<img alt="../_images/079255c3de752eb910a0867dc2c86f012a26c484f771dcacd5c08c4b8372da7f.png" src="../_images/079255c3de752eb910a0867dc2c86f012a26c484f771dcacd5c08c4b8372da7f.png" />
<img alt="../_images/6c51397cdec44a84a6af1e1972530e58b13a97c602ab0d87219e455f69f67a1f.png" src="../_images/6c51397cdec44a84a6af1e1972530e58b13a97c602ab0d87219e455f69f67a1f.png" />
<img alt="../_images/0656c2db38d125be3ed83ed0032d4f85fad45a1e4fe47c53c712f30d68313591.png" src="../_images/0656c2db38d125be3ed83ed0032d4f85fad45a1e4fe47c53c712f30d68313591.png" />
<img alt="../_images/d4ca738f8339bbc5e152e69b9acfec2ecf147944c4e2dcd6a47f10d32ce51616.png" src="../_images/d4ca738f8339bbc5e152e69b9acfec2ecf147944c4e2dcd6a47f10d32ce51616.png" />
<img alt="../_images/6c3e6630cfc6c1b88c8c8406fefc5f5f8ce6f6359a0e00fbe11f7e1a5bc745c2.png" src="../_images/6c3e6630cfc6c1b88c8c8406fefc5f5f8ce6f6359a0e00fbe11f7e1a5bc745c2.png" />
<img alt="../_images/e21bf3771313fabd4c81e20411d2ab7913b45b973ecce640eeabfbb104753713.png" src="../_images/e21bf3771313fabd4c81e20411d2ab7913b45b973ecce640eeabfbb104753713.png" />
<img alt="../_images/519cbaafb1ed860cfc9a406c605b5a1cabab2958d8e42eb05c626c40f3ed7d48.png" src="../_images/519cbaafb1ed860cfc9a406c605b5a1cabab2958d8e42eb05c626c40f3ed7d48.png" />
<img alt="../_images/bcfd575d85df083b7a6c22e7733b51b5cfe8bd31dfe185a83dafc1669ca68317.png" src="../_images/bcfd575d85df083b7a6c22e7733b51b5cfe8bd31dfe185a83dafc1669ca68317.png" />
<img alt="../_images/714f9a94da2febbe8a996871883cc6a7b2bdd5144686f03a3b063764b2ed8378.png" src="../_images/714f9a94da2febbe8a996871883cc6a7b2bdd5144686f03a3b063764b2ed8378.png" />
<img alt="../_images/fa835f3174a802cac73a828bfde64d3317733bcbbf32183b96bf9886aab73a4e.png" src="../_images/fa835f3174a802cac73a828bfde64d3317733bcbbf32183b96bf9886aab73a4e.png" />
<img alt="../_images/d4bfd3d36b589ca76037ddd7b680c5b13e810dcc535abf6699d8db0a10577e42.png" src="../_images/d4bfd3d36b589ca76037ddd7b680c5b13e810dcc535abf6699d8db0a10577e42.png" />
<img alt="../_images/a6418fa8cbc05fef64fb6b9efc876948b37e3eb5179a36ab2cc015b9a6d923c1.png" src="../_images/a6418fa8cbc05fef64fb6b9efc876948b37e3eb5179a36ab2cc015b9a6d923c1.png" />
<img alt="../_images/cc6023af8e4069c82371f509b7be09a5395aac2a474ee6ae83255b955916f3e4.png" src="../_images/cc6023af8e4069c82371f509b7be09a5395aac2a474ee6ae83255b955916f3e4.png" />
<img alt="../_images/bcd7c5dea7a528537aa819103fdcb8396a401caaac9b914dc38cb287f808f34a.png" src="../_images/bcd7c5dea7a528537aa819103fdcb8396a401caaac9b914dc38cb287f808f34a.png" />
<img alt="../_images/9eff7a564f1ead0c3f696fab87d28e25910eab90881aeef5f899a6d1ef1346ec.png" src="../_images/9eff7a564f1ead0c3f696fab87d28e25910eab90881aeef5f899a6d1ef1346ec.png" />
<img alt="../_images/e78ce3534339b3f62cae95ff031a3da68d0aa6b6a8089794ee1f3b6ea415173a.png" src="../_images/e78ce3534339b3f62cae95ff031a3da68d0aa6b6a8089794ee1f3b6ea415173a.png" />
<img alt="../_images/f705f117fec4db66cbfe4e471415c4f235a37176d0906449e7fb56f48a54ac06.png" src="../_images/f705f117fec4db66cbfe4e471415c4f235a37176d0906449e7fb56f48a54ac06.png" />
</div>
</div>
</section>
<section id="plotting-the-mean-conformal-and-equiareal-error-curve-during-relaxation">
<h2>4. Plotting the mean conformal and equiareal error curve during relaxation<a class="headerlink" href="#plotting-the-mean-conformal-and-equiareal-error-curve-during-relaxation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_conformal_curve</span> <span class="o">=</span> <span class="n">conformal_error_flow_arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">mean_area_distort_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">area_distortion_iter</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="kn">import</span> <span class="nn">pylab</span> <span class="k">as</span> <span class="nn">plt</span> 

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration Number&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Conformal error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_conformal_curve</span><span class="p">)),</span> <span class="n">mean_conformal_curve</span><span class="p">,</span> <span class="s1">&#39;ko-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">min_area_distort</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">mean_conformal_curve</span><span class="p">),</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>  <span class="c1"># instantiate a second axes that shares the same x-axis</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Final area / initial area&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>  <span class="c1"># we already handled the x-label with ax1</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_area_distort_curve</span><span class="p">)),</span> <span class="mf">1.</span><span class="o">/</span><span class="n">mean_area_distort_curve</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savefolder</span><span class="p">,</span>  
                        <span class="s1">&#39;mean_area-relax_distortion_errors_iterations_&#39;</span><span class="o">+</span><span class="n">basefname</span><span class="o">+</span><span class="s1">&#39;.png&#39;</span><span class="p">),</span> 
            <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    
<span class="c1"># print the mean errors</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean conformal distortion at selected iteration number: &#39;</span><span class="p">,</span> <span class="n">mean_conformal_curve</span><span class="p">[</span><span class="n">min_area_distort</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mean area distortion at selected iteration number &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">area_distortion_iter</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="n">min_area_distort</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bc06f2c49915cbfd19b9aa169686af2d4770f95fb54d8358b0ac5718ceb002b5.png" src="../_images/bc06f2c49915cbfd19b9aa169686af2d4770f95fb54d8358b0ac5718ceb002b5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean conformal distortion at selected iteration number:  1.5382336929755507
mean area distortion at selected iteration number  0.9995375983497246
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-tradeoff-between-conformal-and-equiareal">
<h2>5. The tradeoff between conformal and equiareal<a class="headerlink" href="#the-tradeoff-between-conformal-and-equiareal" title="Link to this heading">#</a></h2>
<p>You will notice a tradeoff between conformal and area distortion. Conceptually, this is because conformal is akin to ‘rigid’ transformation, triangles are not allowed to change shape, only rotate and rescale, area distortion is akin to ‘nonrigid’ transformation whereby inevitably the edge lengths and shapes of triangles are allowed to deform.</p>
<p>To make this explicit, we can plot the combined ‘isometric’ error proposed in the u-Unwrap3D paper, conformal + log(area distortion). It is then apparent that there exists a global minimum where both types of errors are minimized. (green dashed line).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_combined</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">mean_conformal_curve</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean_area_distort_curve</span><span class="p">))</span>

<span class="c1"># plotting combined conformal + log(area distortion) error</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration Number&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Conformal + log(area distortion) error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean_conformal_curve</span><span class="p">)),</span> <span class="n">mean_conformal_curve</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean_area_distort_curve</span><span class="p">),</span> <span class="s1">&#39;go-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">min_area_distort</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">mean_conformal_curve</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean_area_distort_curve</span><span class="p">)),</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># this is the iteration number for equiareal</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">min_combined</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">mean_conformal_curve</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean_area_distort_curve</span><span class="p">)),</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># this is the iteration number for global minimum of conformal + equiareal</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/21d0c1ee3606453f9084f08f290186fb41ae0899291147863e7b9b7ff83fb347.png" src="../_images/21d0c1ee3606453f9084f08f290186fb41ae0899291147863e7b9b7ff83fb347.png" />
</div>
</div>
<p>Generally, however for surface protrusions, at the iteration number that minimizes conformal and area distortion equally (dashed green), the area distortion relaxation is insufficient. Consequently we recommend to parameterize the isometric error with a weighting <span class="math notranslate nohighlight">\(\lambda\)</span>:
$<span class="math notranslate nohighlight">\( \text{Isometric error}(\lambda) = (1-\lambda)\cdot \text{conformal} + \lambda \cdot \log \text{area distortion}\)</span><span class="math notranslate nohighlight">\(
We plot the family of curves according to this hybrid error, showing how increasing \)</span>\lambda<span class="math notranslate nohighlight">\( favors more equiareal, and decreasing \)</span>\lambda$ favors the initial conformal parameterization.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="n">isometric_errors_curves</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">lams</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">lams_min_iter</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">lam</span> <span class="ow">in</span> <span class="n">lams</span><span class="p">:</span>
    <span class="n">isometric_errors_curve</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">lam</span><span class="p">)</span><span class="o">*</span><span class="n">mean_conformal_curve</span> <span class="o">+</span> <span class="n">lam</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mean_area_distort_curve</span><span class="p">)</span>
    <span class="n">isometric_errors_curves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isometric_errors_curve</span><span class="p">)</span>
    <span class="n">lams_min_iter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">isometric_errors_curve</span><span class="p">))</span>

<span class="c1"># isometric_errors_curves_colors = sns.color_palette(&#39;RdYlBu_r&#39;, len(isometric_errors_curves))</span>
<span class="c1"># isometric_errors_curves_colors = np.vstack(isometric_errors_curves_colors)</span>
<span class="n">isometric_errors_curves_colors</span> <span class="o">=</span> <span class="n">vol_colors</span><span class="o">.</span><span class="n">get_colors</span><span class="p">(</span><span class="n">lams</span><span class="p">,</span> 
                                                       <span class="n">colormap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlBu_r</span><span class="p">)</span>

<span class="c1"># plotting the curves </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Iteration Number&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lam_ii</span><span class="p">,</span> <span class="n">lam_err_curve</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">isometric_errors_curves</span><span class="p">):</span>
    <span class="c1"># plot curve</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lam_err_curve</span><span class="p">)),</span> <span class="n">lam_err_curve</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">isometric_errors_curves_colors</span><span class="p">[</span><span class="n">lam_ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\lambda=</span><span class="si">%.2f</span><span class="s1">$&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">lams</span><span class="p">[</span><span class="n">lam_ii</span><span class="p">]))</span>
    <span class="c1"># plot minimum iteration number on curve</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lams_min_iter</span><span class="p">[</span><span class="n">lam_ii</span><span class="p">],</span> 
            <span class="n">lam_err_curve</span><span class="p">[</span><span class="n">lams_min_iter</span><span class="p">[</span><span class="n">lam_ii</span><span class="p">]],</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> 
            <span class="n">color</span><span class="o">=</span><span class="n">isometric_errors_curves_colors</span><span class="p">[</span><span class="n">lam_ii</span><span class="p">],</span> <span class="n">mec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontname</span><span class="o">=</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dc801efbfaa262c1190234238ba19640a19807e9953a49c1def5b66b3279b933.png" src="../_images/dc801efbfaa262c1190234238ba19640a19807e9953a49c1def5b66b3279b933.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Save all the computed measurements out </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">save_sphere_parametrization_mat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">savefolder</span><span class="p">,</span> 
                                                <span class="s1">&#39;Sref_area_relax_sphere.mat&#39;</span><span class="p">)</span>
<span class="n">spio</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">save_sphere_parametrization_mat</span><span class="p">,</span>
              <span class="p">{</span><span class="s1">&#39;relax_v&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relax_v</span><span class="p">),</span> 
              <span class="s1">&#39;relax_f&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">relax_f</span><span class="p">),</span> 
              <span class="s1">&#39;area_distortion_iter&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">area_distortion_iter</span><span class="p">),</span> <span class="c1"># we have this saved.... (we want also the conformal area?)</span>
              <span class="s1">&#39;min_area_distort_id&#39;</span><span class="p">:</span><span class="n">min_area_distort</span><span class="p">,</span>
              <span class="s1">&#39;sphere_param&#39;</span><span class="p">:</span> <span class="n">conformal_sphere_mesh</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> 
              <span class="s1">&#39;conformal_Jac_eigvals&#39;</span><span class="p">:</span> <span class="n">conformal_error_flow_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
              <span class="s1">&#39;conformal_stretch_factors&#39;</span><span class="p">:</span> <span class="n">conformal_error_flow_arrays</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
              <span class="s1">&#39;mean_conformal_stretch_factors&#39;</span><span class="p">:</span> <span class="n">conformal_error_flow_arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
              <span class="s1">&#39;conformal_tri_area_pairs&#39;</span><span class="p">:</span> <span class="n">conformal_error_flow_arrays</span><span class="p">[</span><span class="mi">3</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="troubleshooting-tips-for-area-distortion-relaxation">
<h2>Troubleshooting tips for area distortion relaxation<a class="headerlink" href="#troubleshooting-tips-for-area-distortion-relaxation" title="Link to this heading">#</a></h2>
<p>We have noticed several common occurrences of how the area distortion relaxation appears to fail, and how to address them here.</p>
<section id="the-function-doesn-t-complete-1-iteration-of-relaxation-and-terminates-early">
<h3>1. The function doesn’t complete 1 iteration of relaxation and terminates early.<a class="headerlink" href="#the-function-doesn-t-complete-1-iteration-of-relaxation-and-terminates-early" title="Link to this heading">#</a></h3>
<p><em>Reason</em>: the Lapacian matrix is likely singular or close to singular, and therefore cannot support matrix inversion for backwards Euler. This is likely one of or all of the following:</p>
<ul class="simple">
<li><p>at least one triangle face of your conformal spherical parameterization has interior angle close to <span class="math notranslate nohighlight">\(0^0\)</span>. Check by running <code class="docutils literal notranslate"><span class="pre">unwrap3D.Mesh.meshtools.measure_triangle_props</span></code>. The minimum angle of your mesh should be at least &gt; <span class="math notranslate nohighlight">\(10^0\)</span> (poor triangle quality)</p></li>
<li><p>at least one triangle face of your conformal spherical parameterization has too small a surface area relative to floating point precision. Check by computing face area using <code class="docutils literal notranslate"><span class="pre">igl</span></code>, using the code <code class="docutils literal notranslate"><span class="pre">igl.doublearea(v,f)/2.</span></code> where <code class="docutils literal notranslate"><span class="pre">v</span></code> and <code class="docutils literal notranslate"><span class="pre">f</span></code> is the vertices and faces of the mesh respectively.</p></li>
<li><p><span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> was not genus-0 or if it is, you have a thin neck or a ‘plate-like’ infill of a handle (if using shrinkwrapping)</p></li>
</ul>
<p><em>Fix</em>: recompute genus-0 <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> from Step 1 and perform the conformal spherical map in Step 2 using the iterative method</p>
<ul class="simple">
<li><p>use <code class="docutils literal notranslate"><span class="pre">remesh_method='CGAL'</span></code> for isotropic remeshing to improve triangle quality in <code class="docutils literal notranslate"><span class="pre">unwrap3D.Mesh.meshtools.marching_cubes_mesh_binary</span></code> and that you have remesh active, i.e. <code class="docutils literal notranslate"><span class="pre">remesh=True</span></code></p></li>
<li><p>use lower <code class="docutils literal notranslate"><span class="pre">remesh_samples</span></code> after voxelization with <code class="docutils literal notranslate"><span class="pre">unwrap3D.Mesh.meshtools.marching_cubes_mesh_binary</span></code> to generate a coarser mesh</p></li>
<li><p>use a dilated voxelization i.e. set <code class="docutils literal notranslate"><span class="pre">ksize_dilate</span></code> at least greater than <code class="docutils literal notranslate"><span class="pre">ksize_erode</span></code> by 2.</p></li>
</ul>
</section>
<section id="relaxation-runs-for-xxx-iterations-doesn-t-finish-and-area-distortion-at-min-area-distort-is-much-greater-than-1">
<h3>2. Relaxation runs for XXX iterations, doesn’t finish and area distortion at <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code> is much greater than 1.<a class="headerlink" href="#relaxation-runs-for-xxx-iterations-doesn-t-finish-and-area-distortion-at-min-area-distort-is-much-greater-than-1" title="Link to this heading">#</a></h3>
<p><em>Reason</em>: There’s two potential reasons:</p>
<ol class="arabic simple">
<li><p>the shape or mesh of <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> is preventing diffusion. <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> likely has a diffusion-limiting geometry such as a thin neck or a ‘plate-like’ infill of a handle, or <code class="docutils literal notranslate"><span class="pre">remesh_samples</span></code> is too high, leading to too small a triangle area in the conformal spherical parameterization.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delta</span></code> is too high or too low. <code class="docutils literal notranslate"><span class="pre">delta</span></code> governs ‘stiffness’ between edges. If you have a densely sampled mesh, i.e. lots of vertices <code class="docutils literal notranslate"><span class="pre">delta=0.1</span></code> may be too high, and there is barely any relaxation. The triangle area also internally limits the diffusion step size. Check by setting <code class="docutils literal notranslate"><span class="pre">debugviz=True</span></code>. The histogram bars should noticeably shift lower every iteration. If not, its a sign of too high a <code class="docutils literal notranslate"><span class="pre">delta</span></code>. Similarly, if <code class="docutils literal notranslate"><span class="pre">delta</span></code> is too low, its hard for neighboring vertices to maintain connectivity (move together). This often leads to visible ‘wiggles’ when plotting the <code class="docutils literal notranslate"><span class="pre">area_distortion_iter_curve</span></code> curve.</p></li>
</ol>
<p><em>Fix</em>:</p>
<ol class="arabic simple">
<li><p>recompute genus-0 <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> from Step 1 and perform the conformal spherical map in Step 2 using the iterative method as for troubleshooting 1 above i.e. use <code class="docutils literal notranslate"><span class="pre">remesh_method='CGAL'</span></code>, use lower <code class="docutils literal notranslate"><span class="pre">remesh_samples</span></code> (drop <code class="docutils literal notranslate"><span class="pre">min_mesh_size</span></code> too accordingly), set <code class="docutils literal notranslate"><span class="pre">ksize_dilate</span></code>&gt;<code class="docutils literal notranslate"><span class="pre">ksize_erode</span></code> to widen geometry features. Generally, you will spot problematic geometry because the <code class="docutils literal notranslate"><span class="pre">area_distortion_iter_curve</span></code> will not go down smoothly - it should show monotoniic linear decrease then plateau as it hits the minimum, as for the example here. Critically the first part whilst its minimizing is smooth.</p></li>
<li><p>start with <code class="docutils literal notranslate"><span class="pre">delta=0.1</span></code> go down as <code class="docutils literal notranslate"><span class="pre">delta=0.05,</span> <span class="pre">0.01,</span> <span class="pre">0.005,</span> <span class="pre">0.001</span> <span class="pre">etc.</span></code>. If its not improving, try setting <code class="docutils literal notranslate"><span class="pre">lloyd_relax_bool=True</span></code> - this performs <a class="reference external" href="https://en.wikipedia.org/wiki/Lloyd%27s_algorithm">lloyd relaxation</a> of the mesh every <code class="docutils literal notranslate"><span class="pre">lloyd_every_iter</span></code> iterations to help improve triangle quality during the flow. This is most helpful for densely sampled meshes.</p></li>
</ol>
</section>
<section id="cannot-find-automatically-min-area-distort">
<h3>3. Cannot find automatically <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code><a class="headerlink" href="#cannot-find-automatically-min-area-distort" title="Link to this heading">#</a></h3>
<p><em>Reason</em>: <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code> is computed by observing the sign change when the <code class="docutils literal notranslate"><span class="pre">area_distortion_iter_curve</span></code> first changes sign from negative to positive. This assumes you run iterations after full convergence. There is two reasons if the other two troubleshooting do not apply:</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> is essentially spherical or close to. In this case conformal = equiareal parameterization. Therefore there is no need to relax.</p></li>
<li><p>the relaxation has yet to converge. If <code class="docutils literal notranslate"><span class="pre">stepsize=1</span></code> already, then increase <code class="docutils literal notranslate"><span class="pre">max_iter</span></code>. The larger the deviation of <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span> is from a sphere, the greater the <code class="docutils literal notranslate"><span class="pre">max_iter</span></code> required. Particulary for elongated structures, its not unusual to set <code class="docutils literal notranslate"><span class="pre">max_iter=1000</span></code>.</p></li>
</ol>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./03_basic_workflow"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Step2_quasiconformal_spherical_parameterization.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Step 2: Quasi-conformal spherical parameterization of the genus-0 reference surface, <span class="math notranslate nohighlight">\(S_{ref}(x,y,z)\)</span></p>
      </div>
    </a>
    <a class="right-next"
       href="Step4_uv_mapping_spherical_parameterization.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Step 4: UV mapping <span class="math notranslate nohighlight">\(S_{ref}(x,y,z)\)</span> into 2D using its spherical parameterization, <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\Omega}(x,y,z)\)</span></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-s-text-ref-x-y-z-and-s-text-ref-mathcal-q-x-y-z-mesh">1. Load <span class="math notranslate nohighlight">\(S_{\text{ref}}(x,y,z)\)</span>  and <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\mathcal{Q}}(x,y,z)\)</span> mesh</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#equiareal-spherical-parameterization-s-text-ref-omega-x-y-z-by-diffusing-area-distortion">2. Equiareal spherical parameterization, <span class="math notranslate nohighlight">\(S_{\text{ref}}^{\Omega}(x,y,z)\)</span> by diffusing area distortion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantifying-and-visualizing-the-conformal-and-equiareal-distortion-error-during-relaxation">3. Quantifying and visualizing the conformal and equiareal distortion error during relaxation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotting-the-mean-conformal-and-equiareal-error-curve-during-relaxation">4. Plotting the mean conformal and equiareal error curve during relaxation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-tradeoff-between-conformal-and-equiareal">5. The tradeoff between conformal and equiareal</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#troubleshooting-tips-for-area-distortion-relaxation">Troubleshooting tips for area distortion relaxation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-function-doesn-t-complete-1-iteration-of-relaxation-and-terminates-early">1. The function doesn’t complete 1 iteration of relaxation and terminates early.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relaxation-runs-for-xxx-iterations-doesn-t-finish-and-area-distortion-at-min-area-distort-is-much-greater-than-1">2. Relaxation runs for XXX iterations, doesn’t finish and area distortion at <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code> is much greater than 1.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cannot-find-automatically-min-area-distort">3. Cannot find automatically <code class="docutils literal notranslate"><span class="pre">min_area_distort</span></code></a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Felix Y. Zhou
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
Copyright: Licensed <a href="https://github.com/fyz11/u-Unwrap3D_notebooks/blob/main/LICENSE" target="_blank">GPL3</a> unless mentioned otherwise. 
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>